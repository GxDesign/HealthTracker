/* Fullcalendar initialization */



$(document).ready(function() {

    $("#appt-form").submit(function(event){
        event.preventDefault();
        var values = {};
        $.each($('#appt-form').serializeArray(), function(i, field) {
           values[field.name] = field.value;
        });
        $.post("/new-appointment", values, function(data) {
            $('#calendar').fullCalendar("refetchEvents");
        });
    });

    var today = new Date();
    var todayD = today.getDate();
    var todayM = today.getMonth();
    var todayY = today.getFullYear();

    $('#calendar').fullCalendar({
        header: {
            left:   "today prev, next",
            center: "title",
            right:  "month, agendaWeek, agendaDay"
        },
        minTime: "08:00:00",
        editable: true,
        selectable: true,
        selectHelper:true,

        select: function(start, end, event) {
            debugger

            var title = prompt('Event Title:');
            var eventData;
            if (title) {
                eventData = {
                    title: title,
                    start: start,
                    end: end,
                };

            // $.ajax({
            //   url: 'new-appointment',
            //   contentType: 'application/json',
            //   data: eventData,
            //   type: 'GET'
            // }).done(function(data) {
            //     console.log('Successful! ', data);
            // });

                $('#calendar').fullCalendar('renderEvent', eventData, true);
                $('#calendar-today').fullCalendar('renderEvent', eventData, true);
            }
            $('#calendar').fullCalendar('unselect');
            $('#calendar-today').fullCalendar('unselect');
        },
        droppable: true,
        drop: function() {
            $(this).remove();
            var nEvents = $('#pending-events div.pending-event').length;
            if (nEvents<=0) {
                nEvents = "No";
                $('#pending-events-container').remove();
            }
            $('#pending-counter').html(nEvents);
        },

        eventSources: [{
                url: '/responseblake',
                backgroundColor: 'yellow',   // an option!
                textColor: 'white' // an option!
            }],
    });

    $('#calendar-today').fullCalendar({
        header: {
            left:   false,
            center: false,
            right:  false
        },
        defaultView: 'basicDay',
        events: [
            {
                title: 'Long Event',
                start: new Date(todayY, todayM, todayD),
                end: new Date(todayY, todayM, todayD+2),
                allDay: true
            },
            {
                title: 'Meeting',
                start: new Date(todayY, todayM, todayD, 10, 30, 00),
                end: new Date(todayY, todayM, todayD, 11, 30, 00)
            },
            {
                title: 'Product Meeting',
                start: new Date(todayY, todayM, todayD, 15, 30, 00),
                end: new Date(todayY, todayM, todayD, 17, 30, 00)
            }
        ]
    });
    $('#calendar-today .fc-toolbar').remove();

});  
           




